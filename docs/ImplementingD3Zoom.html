<!DOCTYPE html>
<html lang="en">
	<head>
		<!-- Meta tags -->
		<meta charset="utf-8">
		<meta http-equiv="content-type" content="text/html; charset=utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">

		<title>Ravin Kumar</title>
		<link rel="shortcut icon" type="image/x-icon" href="https://ravinkumar.com/images/logo/logo.png" />

		<meta name="description" content="Ravin Kumar is a data scientist and an open source contributor." />
		<meta property="og:title" content="Ravin Kumar" />
		<meta property="og:url" content="https://ravinkumar.com" />
		<meta property="og:image" content="https://ravinkumar.com/images/logo/logo.png" />
		<meta property="og:description" content="Ravin Kumar is a data scientist and an open source contributor." />
		<meta name="twitter:site" content="https://twitter.com/canyon289" />
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

		<!-- Jupyter Notebooks -->

<!--Notebook Configuration-->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
      tex2jax: {
          inlineMath: [['$','$'], ['\\(','\\)']],
          processEscapes: true,
          displayMath: [['$$','$$'], ["\\[","\\]"]]
      }
  });
</script>

<script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML">
</script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>

<script type="text/javascript">
  jQuery(document).ready(function($) {
      $("div.collapseheader").click(function () {
      $header = $(this).children("span").first();
      $codearea = $(this).children(".input_area");
      console.log($(this).children());
      $codearea.slideToggle(500, function () {
          $header.text(function () {
              return $codearea.is(":visible") ? "Collapse Code" : "Expand Code";
          });
      });
  });
  });
</script>

		<!-- CSS -->
		<link rel="stylesheet" href="https://ravinkumar.com/theme/css/jupyternotebook.css" />
		<link rel="stylesheet" href="https://ravinkumar.com/theme/css/codesyntax.css" />
        <link rel="stylesheet" href="https://ravinkumar.com/theme/css/svgstyles.css" />
		<link rel="stylesheet" href="https://ravinkumar.com/theme/css/main.css" />
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">

        <!-- CSS for Pelican Javascript plugin -->
                    <link rel="stylesheet" href="https://ravinkumar.com/css/svgcenter.css" type="text/css" />

		<!-- RSS -->
		<link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
		
		<!-- Google Analytics -->
	<script type="text/javascript">
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
 			(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
 			m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
 			})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
			ga('create', 'UA-52706904-2', 'auto');
			ga('send', 'pageview');
	</script>
	</head>

	<body class='page body-article'>  <!-- extends -->

<div id="main-menu-mobile" class="main-menu-mobile">
    <ul>
        <li class="menu-item-home"></li>
            <a href="https://ravinkumar.com">
                <img alt="Logo" src="https://ravinkumar.com/images/logo/logo-stroke-white.png" style="padding: 10px;"/>
            </a>
        </li>
        <!---Add Blog Manually --->
        <li class="menu-item-blog">
            <a href="https://ravinkumar.com/blog.html">
                <span>Blog</span>
            </a>
        </li>
        <!---Add Remaining Pages (excluding About) --->
           <li class="menu-item-references">
            <a href="https://ravinkumar.com/pages/References.html">
                <span>References</span>
            </a>
        </li>
          <li class="menu-item-talks">
            <a href="https://ravinkumar.com/pages/Talks.html">
                <span>Talks</span>
            </a>
        </li>
     </ul>
</div>
		<div class="wrapper body-wrapper">
			<!-- Header -->
<div class="header">
    <div class="logo">
        <a href="https://ravinkumar.com">
            <img alt="Logo" src="https://ravinkumar.com/images/logo/logo.png" style="padding: 10px;"/>
        </a>
    </div>
    <div class="logo-mobile">
        <a href="https://ravinkumar.com">
            <img alt="Logo" src="https://ravinkumar.com/images/logo/logo.png" style="padding: 10%;"/>
        </a>
    </div>
<div id="main-menu" class="main-menu">
    <ul>
        <!---Add Blog Manually --->
        <li class="menu-item-blog">
            <a href="https://ravinkumar.com/blog.html">Blog</a>
        </li>
        <!---Add Remaining Pages (excluding About) --->
           <li class="menu-item-references">
            <a href="https://ravinkumar.com/pages/References.html">References</a>
        </li>
          <li class="menu-item-talks">
            <a href="https://ravinkumar.com/pages/Talks.html">Talks</a>
        </li>
     </ul>
</div><button id="toggle-main-menu-mobile" class="hamburger hamburger--slider" type="button">
    <span class="hamburger-box">
        <span class="hamburger-inner"></span>
    </span>
</button></div>		
			<!-- Content -->
<div class="categories-menu">
  <h4>Search by Category</h4>
  <ul class="categories">
    <li>
        <a href="https://ravinkumar.com/category/data-science.html" class="active">Data Science</a>
    </li>
    <li>
        <a href="https://ravinkumar.com/category/life.html" class="">Life</a>
    </li>
    <li>
        <a href="https://ravinkumar.com/category/programming.html" class="">Programming</a>
    </li>
    <li>
        <a href="https://ravinkumar.com/category/statistics.html" class="">Statistics</a>
    </li>
  </ul>
</div>			<div class="content">

	<h1 class="page-title">Implementing Zoom in D3 4.0</h1>
	<p class="post-date">Aug 27, 2016</p>
	<p>D3 is a fantastic library for sharing and engaging users in visualizations.
One of the best ways it does this is by leveraging user interactions, by means
of clicks, drags, and scrolls to highlight data. We'll be exploring how to 
implement one of these interactions, the zoom interaction in D3 4.0</p>
<h2 id="the-benefits-of-zoom">The benefits of Zoom</h2>
<p>In data visualization zooming is a handy method to allow the user both see the
whole picture but also the minute details. This also means the user can focus 
on the details that personally matter to them. Perhaps the most prevalent 
example of this is with services like Google Maps, where users can seamlessly
transition from a map of the entire world, to a detailed map of their neighborhood.</p>
<h2 id="zoom-in-d3">Zoom in D3</h2>
<p>As with the rest of the library zoom in D3 the API is not immediately obvious,
and potentially frustrating. However as you become more familiar with it you'll
come to realize how well it implements an intuitive response and abstracts away
complicated mathematical but still leaves the ability to change the underlying behavior.</p>
<h2 id="the-one-liner">The One Liner</h2>
<p>If you need basic zooming and panning behavior and in D3 it's extremely simple
to implement.  </p>
<p>Let's start by creating an svg with a group and adding a circle to it.</p>
<div class="highlight"><pre><span class="code-line"><span></span><span class="kd">var</span> <span class="nx">svg</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s2">&quot;#basic_zoom&quot;</span><span class="p">)</span></span>
<span class="code-line">   <span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;svg&quot;</span><span class="p">)</span></span>
<span class="code-line">     <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;width&quot;</span><span class="p">,</span> <span class="mf">100</span><span class="p">)</span></span>
<span class="code-line">     <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;height&quot;</span><span class="p">,</span> <span class="mf">100</span><span class="p">);</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="kd">var</span> <span class="nx">g</span> <span class="o">=</span> <span class="nx">svg</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;g&quot;</span><span class="p">);</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="nx">g</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;circle&quot;</span><span class="p">)</span></span>
<span class="code-line">     <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;cx&quot;</span><span class="p">,</span> <span class="mf">50</span><span class="p">)</span></span>
<span class="code-line">     <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;cy&quot;</span><span class="p">,</span> <span class="mf">50</span><span class="p">)</span></span>
<span class="code-line">     <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="mf">10</span><span class="p">);</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="nx">svg</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;circle&quot;</span><span class="p">)</span></span>
<span class="code-line">     <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;cx&quot;</span><span class="p">,</span> <span class="mf">50</span><span class="p">)</span></span>
<span class="code-line">     <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;cy&quot;</span><span class="p">,</span> <span class="mf">50</span><span class="p">)</span></span>
<span class="code-line">     <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="mf">10</span><span class="p">);</span></span>
</pre></div>


<p>Adding zoom and pan behavior is one additional line</p>
<div class="highlight"><pre><span class="code-line"><span></span><span class="nx">svg</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">d3</span><span class="p">.</span><span class="nx">zoom</span><span class="p">().</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;zoom&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span><span class="nx">g</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;transform&quot;</span><span class="p">,</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">transform</span><span class="p">)}))</span></span>
</pre></div>


<div id="basic_zoom"></div>

<p><strong>Before you leave</strong> note that the event listener has been applied to the svg
but the transformation is applied to the group.</p>
<h2 id="zoom-margin-convention">Zoom + Margin convention</h2>
<p>For the visualization I was building at first I was thrilled having solved
my problem, but I ran into another problem.  </p>
<p>My visualization was using the <a href="https://bl.ocks.org/mbostock/3019563">margin convention</a>
and something odd was happening. See if you can find the same issue.</p>
<p>Here's the code (bounding box added for reference)</p>
<div class="highlight"><pre><span class="code-line"><span></span><span class="kd">var</span> <span class="nx">margin</span> <span class="o">=</span> <span class="p">{</span><span class="nx">top</span><span class="o">:</span> <span class="mf">50</span><span class="p">,</span> <span class="nx">right</span><span class="o">:</span> <span class="mf">0</span><span class="p">,</span> <span class="nx">bottom</span><span class="o">:</span> <span class="mf">0</span><span class="p">,</span> <span class="nx">left</span><span class="o">:</span> <span class="mf">50</span><span class="p">};</span></span>
<span class="code-line"><span class="kd">var</span> <span class="nx">width</span> <span class="o">=</span> <span class="mf">50</span> <span class="o">+</span> <span class="nx">margin</span><span class="p">.</span><span class="nx">left</span> <span class="o">+</span> <span class="nx">margin</span><span class="p">.</span><span class="nx">right</span><span class="p">;</span></span>
<span class="code-line"><span class="kd">var</span> <span class="nx">height</span> <span class="o">=</span> <span class="mf">50</span> <span class="o">+</span> <span class="nx">margin</span><span class="p">.</span><span class="nx">top</span> <span class="o">+</span> <span class="nx">margin</span><span class="p">.</span><span class="nx">right</span><span class="p">;</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="kd">var</span> <span class="nx">svg</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s2">&quot;#margin_zoom&quot;</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;svg&quot;</span><span class="p">)</span></span>
<span class="code-line">   <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;width&quot;</span><span class="p">,</span> <span class="nx">width</span><span class="p">)</span></span>
<span class="code-line">   <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;height&quot;</span><span class="p">,</span> <span class="nx">height</span><span class="p">);</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="c1">//Bounding Box</span></span>
<span class="code-line"><span class="nx">svg</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;rect&quot;</span><span class="p">)</span></span>
<span class="code-line">   <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;width&quot;</span><span class="p">,</span> <span class="nx">width</span><span class="p">)</span></span>
<span class="code-line">   <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;height&quot;</span><span class="p">,</span> <span class="nx">height</span><span class="p">)</span></span>
<span class="code-line">   <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;stroke&quot;</span><span class="p">,</span> <span class="s2">&quot;black&quot;</span><span class="p">)</span></span>
<span class="code-line">   <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;stroke-width&quot;</span><span class="p">,</span> <span class="s2">&quot;2px&quot;</span><span class="p">)</span></span>
<span class="code-line">   <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;fill&quot;</span><span class="p">,</span> <span class="s2">&quot;none&quot;</span><span class="p">);</span></span>
<span class="code-line"></span>
<span class="code-line"></span>
<span class="code-line"><span class="kd">var</span> <span class="nx">g</span> <span class="o">=</span> <span class="nx">svg</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;g&quot;</span><span class="p">)</span></span>
<span class="code-line">  <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;transform&quot;</span><span class="p">,</span> <span class="s2">&quot;translate(&quot;</span> <span class="o">+</span> <span class="nx">margin</span><span class="p">.</span><span class="nx">left</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span> <span class="o">+</span> <span class="nx">margin</span><span class="p">.</span><span class="nx">top</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span><span class="p">)</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="nx">g</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;circle&quot;</span><span class="p">)</span></span>
<span class="code-line">   <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;cx&quot;</span><span class="p">,</span> <span class="mf">0</span><span class="p">)</span></span>
<span class="code-line">   <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;cy&quot;</span><span class="p">,</span> <span class="mf">0</span><span class="p">)</span></span>
<span class="code-line">   <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="mf">10</span><span class="p">);</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="nx">svg</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">d3</span><span class="p">.</span><span class="nx">zoom</span><span class="p">().</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;zoom&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span><span class="nx">g</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;transform&quot;</span><span class="p">,</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">transform</span><span class="p">)}))</span></span>
</pre></div>


<p>and here's the resulting visualization. Try zooming and panning and see if you
can spot the issue
<div id="margin_zoom"></div></p>
<p>You may have noticed that on the initial event the circle jumps to the top
left corner (0,0 svg coordinates) but behaves normally after that. In the next
post I'll be explaining why this happens</p>

			</div> 
		</div>

		<!-- Footer -->
<div class="footer">
    <div class="wrapper footer-wrapper">
        <div class="footer-left">
            <div class="footer-logo">
                <a href="https://ravinkumar.com">
                    <img src="https://ravinkumar.com/images/logo/logo.png"/>
                </a>
            </div>
            <div class="footer-mailer">
                <!-- Mailerlite -->
<div class="ml-form-embed"
    data-account="3479153:h8h4b4n7u8"
    data-form="5635182:k0j3t8">
</div>
<!-- Hacky workaround for Mailerlite -->
<style>
    #mlb2-5635182.ml-form-embedContainer .ml-form-embedWrapper .ml-form-embedBody .ml-form-embedContent h4, #mlb2-5635182.ml-form-embedContainer .ml-form-embedWrapper .ml-form-successBody .ml-form-successContent h4 {
        font-weight: bold;
        font-size: 1rem;
        margin: 0 0 5px 0;
    }
</style>
<script>
    (function(m,a,i,l,e,r){ m['MailerLiteObject']=e;function f(){
    var c={ a:arguments,q:[]};var r=this.push(c);return "number"!=typeof r?r:f.bind(c.q);}
    f.q=f.q||[];m[e]=m[e]||f.bind(f.q);m[e].q=m[e].q||f.q;r=a.createElement(i);
    var _=a.getElementsByTagName(i)[0];r.async=1;r.src=l+'?v'+(~~(new Date().getTime()/1000000));
    _.parentNode.insertBefore(r,_);})(window, document, 'script', 'https://static.mailerlite.com/js/universal.js', 'ml');

    var ml_account = ml('accounts', '3479153', 'h8h4b4n7u8', 'load');
</script>            </div>
        </div>
        <div class="footer-social footer-right">
            <div class="social">
                    <a href="https://www.linkedin.com/in/ravinakumar">
                        <i class="fa fa-linkedin"></i>
                    </a>
                    <a href="https://github.com/canyon289">
                        <i class="fa fa-github"></i>
                    </a>
                    <a href="https://twitter.com/canyon289">
                        <i class="fa fa-twitter"></i>
                    </a>
            </div>
        </div>
    </div>
</div>
		<!-- Javascript -->
		<script type="text/javascript" src="https://ravinkumar.com/theme/js/main.js"></script>
		
		<!-- Javascript for Pelican Javascript plugin -->
					<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.2.2/d3.min.js"></script>
					<script src="https://ravinkumar.com/js/D3Zoom.js"></script>
		
	</body>

</html>